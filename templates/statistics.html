{% extends "base.html" %}

{% block title %}Statistics{% endblock %}

{% block content %}
    <h2>Greenhouse Statistics</h2>
    <canvas id="statsChart"></canvas>

    <p><strong>Data Retention:</strong> Greenhouse condition data is saved for a period of {{ RETENTION_PERIOD }} days. Older data is automatically removed after this period to maintain system performance and keep the data relevant.</p>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        async function fetchData() {
            try {
                const response = await fetch("/get_current");
                const data = await response.json();
                console.log(data);  // Log the data to the console to inspect it
                return data.conditions;
            } catch (error) {
                console.error("Error fetching data:", error);
                return null;
            }
        }
    
        async function renderChart() {
            const conditions = await fetchData();
            if (!conditions) {
                console.log("No conditions data available.");
                return;  // Exit if no data
            }
    
            console.log("Conditions data:", conditions);  // Log the conditions to check the data format
    
            const ctx = document.getElementById("statsChart").getContext("2d");
    
            new Chart(ctx, {
                type: "line",
                data: {
                    labels: ["Now"],  // Static for now, update later
                    datasets: [
                        {
                            label: "Temperature (Â°C)",
                            data: [conditions.temperature],
                            borderColor: "red",
                            fill: false
                        },
                        {
                            label: "Humidity (%)",
                            data: [conditions.humidity],
                            borderColor: "blue",
                            fill: false
                        },
                        {
                            label: "CO2 Levels",
                            data: [conditions.co2],
                            borderColor: "green",
                            fill: false
                        },
                        {
                            label: "Soil Moisture",
                            data: [conditions.soilMoisture],
                            borderColor: "brown",
                            fill: false
                        },
                        {
                            label: "TVOC",
                            data: [conditions.tvoc],
                            borderColor: "purple",
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: { title: { display: true, text: "Time" }},
                        y: { title: { display: true, text: "Values" }}
                    }
                }
            });
        }
    
        renderChart();
    </script>
    
    {% endblock %}
